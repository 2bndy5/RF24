

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Python Wrapper examples &mdash; RF24 Revemped 2.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/darkness.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ATTiny examples" href="attiny_examples.html" />
    <link rel="prev" title="Linux examples" href="cpp_examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> RF24 Revemped
          

          
            
            <img src="_static/Logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ino_examples.html">Arduino examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_examples.html">Linux examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Python Wrapper examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started-py">getting_started.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#acknowledgement-payloads-py">acknowledgement_payloads.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#manual-acknowledgements-py">manual_acknowledgements.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiceiver-demo-py">multiceiver_demo.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#streaming-data-py">streaming_data.py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#interrup-configure-py">interrup_configure.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="attiny_examples.html">ATTiny examples</a></li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic_api.html">Basic API</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_api.html">Advanced API</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_api.html">Configuration API</a></li>
</ul>
<p class="caption"><span class="caption-text">Related Pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common_issues.html">Common Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="arduino.html">Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="attiny.html">ATTiny Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_install.html">Linux Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mraa.html">MRAA</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpi_general.html">General Linux/Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_wrapper.html">Python Wrapper Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_compilation.html">Linux cross-compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="atxmega.html">ATXMEGA</a></li>
<li class="toctree-l1"><a class="reference internal" href="portability.html">RF24 Portability</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templated Files for Platform Support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RF24 Revemped</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Python Wrapper examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/py_examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python-wrapper-examples">
<h1>Python Wrapper examples<a class="headerlink" href="#python-wrapper-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="getting-started-py">
<h2>getting_started.py<a class="headerlink" href="#getting-started-py" title="Permalink to this headline">¶</a></h2>
<p>A simple example of sending data from 1 nRF24L01 transceiver to another.
This example was written to be used on 2 devices acting as “nodes”.
Remember to <a class="reference external" href="python_wrapper.html">install the Python wrapper</a>, then navigate to the “RF24/examples_linux” folder.
To run this example, enter</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 getting_started.py
</pre></div>
</div>
<p>and follow the prompts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example requires python v3.7 or newer because it measures transmission time with <a class="reference external" href="https://docs.python.org/3.7/library/time.html#time.monotonic_ns">time.monotonic_ns()</a>.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> to quit at any time, but remember state the radio will persist until another example or application uses it.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">/examples_linux/getting_started.py</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">RF24</span> <span class="kn">import</span> <span class="n">RF24</span><span class="p">,</span> <span class="n">RF24_PA_LOW</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
    <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--node&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the identifying radio number (or node ID number)&quot;</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--role&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&#39;1&#39; specifies the TX role. &#39;0&#39; specifies the RX role.&quot;</span>
<span class="p">)</span>


<span class="c1">########### USER CONFIGURATION ###########</span>
<span class="c1"># See https://github.com/TMRh20/RF24/blob/master/pyRF24/readme.md</span>
<span class="c1"># Radio CE Pin, CSN Pin, SPI Speed</span>
<span class="c1"># CE Pin uses GPIO number with BCM and SPIDEV drivers, other platforms use</span>
<span class="c1"># their own pin numbering</span>
<span class="c1"># CS Pin addresses the SPI bus number at /dev/spidev&lt;a&gt;.&lt;b&gt;</span>
<span class="c1"># ie: RF24 radio(&lt;ce_pin&gt;, &lt;a&gt;*10+&lt;b&gt;); spidev1.0 is 10, spidev1.1 is 11 etc..</span>

<span class="c1"># Generic:</span>
<span class="n">radio</span> <span class="o">=</span> <span class="n">RF24</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">################## Linux (BBB,x86,etc) #########################</span>
<span class="c1"># See http://2bndy5.github.io/RF24/pages.html for more information on usage</span>
<span class="c1"># See http://iotdk.intel.com/docs/master/mraa/ for more information on MRAA</span>
<span class="c1"># See https://www.kernel.org/doc/Documentation/spi/spidev for more</span>
<span class="c1"># information on SPIDEV</span>

<span class="c1"># using the python keyword global is bad practice. Instead we&#39;ll use a 1 item</span>
<span class="c1"># list to store our float number for the payloads sent/received</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">master</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Transmits an incrementing float every second&quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">failures</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># use struct.pack() to packet your data into the payload</span>
        <span class="c1"># &quot;&lt;f&quot; means a single little endian (4 byte) float value.</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;f&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># start timer</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="n">end_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># end timer</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transmission failed or timed out&quot;</span><span class="p">)</span>
            <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Transmission successful! Time to Transmit: &quot;</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> us. Sent: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">end_timer</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">0.01</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">failures</span><span class="p">,</span> <span class="s2">&quot;failures detected. Leaving TX role.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Listen for any payloads and print the transaction</span>

<span class="sd">    :param int timeout: The number of seconds to wait (with no transmission)</span>
<span class="sd">        until exiting function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio in RX mode</span>

    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="n">has_payload</span><span class="p">,</span> <span class="n">pipe_number</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">available_pipe</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">has_payload</span><span class="p">:</span>
            <span class="c1"># fetch 1 payload from RX FIFO</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">)</span>
            <span class="c1"># use struct.unpack() to convert the buffer into usable data</span>
            <span class="c1"># expecting a little endian float, thus the format string &quot;&lt;f&quot;</span>
            <span class="c1"># buffer[:4] truncates padded 0s in case payloadSize was not set</span>
            <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;f&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="p">[:</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># print details about the received packet</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Received </span><span class="si">{}</span><span class="s2"> bytes on pipe </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">,</span>
                    <span class="n">pipe_number</span><span class="p">,</span>
                    <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># reset the timeout timer</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing received in 6 seconds. Leaving RX role&quot;</span><span class="p">)</span>
    <span class="c1"># recommended behavior is to keep in TX mode while idle</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put the radio in TX mode</span>


<span class="k">def</span> <span class="nf">set_role</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set the role using stdin stream. Timeout arg for slave() can be</span>
<span class="sd">    specified using a space delimiter (e.g. &#39;R 10&#39; calls `slave(10)`)</span>

<span class="sd">    :return:</span>
<span class="sd">        - True when role is complete &amp; app should continue running.</span>
<span class="sd">        - False when app should exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
        <span class="s2">&quot;*** Enter &#39;R&#39; for receiver role.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;*** Enter &#39;T&#39; for transmitter role.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;*** Enter &#39;Q&#39; to quit example.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;?&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
        <span class="n">master</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;is an unrecognized input. Please try again.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">set_role</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># parse any CLI args</span>

    <span class="c1"># initialize the nRF24L01 on the spi bus</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;radio hardware is not responding&quot;</span><span class="p">)</span>

    <span class="c1"># For this example, we will use different addresses</span>
    <span class="c1"># An address need to be a buffer protocol object (bytearray)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;1Node&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;2Node&quot;</span><span class="p">]</span>
    <span class="c1"># It is very helpful to think of an address as a path instead of as</span>
    <span class="c1"># an identifying device destination</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># print example name</span>

    <span class="c1"># to use different addresses on a pair of radios, we need a variable to</span>
    <span class="c1"># uniquely identify which address this radio will use to transmit</span>
    <span class="c1"># 0 uses address[0] to transmit, 1 uses address[1] to transmit</span>
    <span class="n">radio_number</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span>  <span class="c1"># uses default value from `parser`</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if &#39;--node&#39; arg wasn&#39;t specified</span>
        <span class="n">radio_number</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span>
                <span class="nb">input</span><span class="p">(</span>
                    <span class="s2">&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39; &quot;</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># set the TX address of the RX node into the TX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># always uses pipe 0</span>

    <span class="c1"># set the RX address of the TX node into a RX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="p">[</span><span class="ow">not</span> <span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># using pipe 1</span>

    <span class="c1"># To save time during transmission, we&#39;ll set the payload size to be only</span>
    <span class="c1"># what we need. A float value occupies 4 bytes in memory using</span>
    <span class="c1"># struct.pack(); &quot;&lt;f&quot; means a little endian unsigned float</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;f&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># for debugging</span>
    <span class="c1"># radio.printDetails()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if not specified with CLI arg &#39;-r&#39;</span>
            <span class="k">while</span> <span class="n">set_role</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># continue example until &#39;Q&#39; is entered</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if role was set using CLI args</span>
            <span class="c1"># run role once and exit</span>
            <span class="n">master</span><span class="p">()</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">role</span><span class="p">)</span> <span class="k">else</span> <span class="n">slave</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Keyboard Interrupt detected. Exiting...&quot;</span><span class="p">)</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="acknowledgement-payloads-py">
<h2>acknowledgement_payloads.py<a class="headerlink" href="#acknowledgement-payloads-py" title="Permalink to this headline">¶</a></h2>
<p>A simple example of sending data from 1 nRF24L01 transceiver to another with Acknowledgement (ACK) payloads attached to ACK packets.
This example was written to be used on 2 devices acting as “nodes”.
Remember to <a class="reference external" href="python_wrapper.html">install the Python wrapper</a>, then navigate to the “RF24/examples_linux” folder.
To run this example, enter</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 acknowledgement_payloads.py
</pre></div>
</div>
<p>and follow the prompts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example requires python v3.7 or newer because it measures transmission time with <a class="reference external" href="https://docs.python.org/3.7/library/time.html#time.monotonic_ns">time.monotonic_ns()</a>.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> to quit at any time, but remember state the radio will persist until another example or application uses it.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">/examples_linux/acknowledgement_payloads.py</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">RF24</span> <span class="kn">import</span> <span class="n">RF24</span><span class="p">,</span> <span class="n">RF24_PA_LOW</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
    <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--node&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the identifying radio number (or node ID number)&quot;</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--role&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&#39;1&#39; specifies the TX role. &#39;0&#39; specifies the RX role.&quot;</span>
<span class="p">)</span>

<span class="c1">########### USER CONFIGURATION ###########</span>
<span class="c1"># See https://github.com/TMRh20/RF24/blob/master/pyRF24/readme.md</span>
<span class="c1"># Radio CE Pin, CSN Pin, SPI Speed</span>
<span class="c1"># CE Pin uses GPIO number with BCM and SPIDEV drivers, other platforms use</span>
<span class="c1"># their own pin numbering</span>
<span class="c1"># CS Pin addresses the SPI bus number at /dev/spidev&lt;a&gt;.&lt;b&gt;</span>
<span class="c1"># ie: RF24 radio(&lt;ce_pin&gt;, &lt;a&gt;*10+&lt;b&gt;); spidev1.0 is 10, spidev1.1 is 11 etc..</span>

<span class="c1"># Generic:</span>
<span class="n">radio</span> <span class="o">=</span> <span class="n">RF24</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">################## Linux (BBB,x86,etc) #########################</span>
<span class="c1"># See http://2bndy5.github.io/RF24/pages.html for more information on usage</span>
<span class="c1"># See http://iotdk.intel.com/docs/master/mraa/ for more information on MRAA</span>
<span class="c1"># See https://www.kernel.org/doc/Documentation/spi/spidev for more</span>
<span class="c1"># information on SPIDEV</span>

<span class="c1"># using the python keyword global is bad practice. Instead we&#39;ll use a</span>
<span class="c1"># 1 item list to store our integer number for the payloads&#39; counter</span>
<span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">master</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Transmits a message and an incrementing integer every second.&quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">failures</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># construct a payload to send</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;Hello </span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>

        <span class="c1"># send the payload and prompt</span>
        <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># start timer</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>  <span class="c1"># save the report</span>
        <span class="n">end_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># stop timer</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># print timer results upon transmission success</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Transmission successful! Time to transmit: &quot;</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2"> us. Sent: </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">int</span><span class="p">((</span><span class="n">end_timer</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span>
                    <span class="n">buffer</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                    <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span>
            <span class="p">)</span>
            <span class="n">has_payload</span><span class="p">,</span> <span class="n">pipe_number</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">available_pipe</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">has_payload</span><span class="p">:</span>
                <span class="c1"># print the received ACK that was automatically sent</span>
                <span class="n">length</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Received </span><span class="si">{}</span><span class="s2"> on pipe </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">length</span><span class="p">,</span>
                        <span class="n">pipe_number</span><span class="p">,</span>
                        <span class="nb">bytes</span><span class="p">(</span><span class="n">response</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                        <span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># increment counter from received payload</span>
                <span class="k">if</span> <span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">:</span>
                    <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received an empty ACK packet&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transmission failed or timed out&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># let the RX node prepare a new ACK payload</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">failures</span><span class="p">,</span> <span class="s2">&quot;failures detected. Leaving TX role.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Listen for any payloads and print the transaction</span>

<span class="sd">    :param int timeout: The number of seconds to wait (with no transmission)</span>
<span class="sd">        until exiting function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio in RX mode</span>

    <span class="c1"># setup the first transmission&#39;s ACK payload</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;World </span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
    <span class="c1"># we must set the ACK payload data and corresponding</span>
    <span class="c1"># pipe number [0,5]</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">writeAck</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>  <span class="c1"># load ACK for first response</span>

    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># start timer</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="n">has_payload</span><span class="p">,</span> <span class="n">pipe_number</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">available_pipe</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">has_payload</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>  <span class="c1"># grab the payload length</span>
            <span class="n">received</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>  <span class="c1"># fetch 1 payload from RX FIFO</span>
            <span class="c1"># increment counter from received payload</span>
            <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">255</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Received </span><span class="si">{}</span><span class="s2"> bytes on pipe </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}{}</span><span class="s2"> Sent: </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">length</span><span class="p">,</span>
                    <span class="n">pipe_number</span><span class="p">,</span>
                    <span class="nb">bytes</span><span class="p">(</span><span class="n">received</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                    <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">buffer</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                    <span class="n">buffer</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;World </span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>  <span class="c1"># build a new ACK payload</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">writeAck</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">)</span>  <span class="c1"># load ACK for next response</span>
            <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># reset timer</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing received in 6 seconds. Leaving RX role&quot;</span><span class="p">)</span>
    <span class="c1"># recommended behavior is to keep in TX mode while idle</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode &amp; flush unused ACK payloads</span>


<span class="k">def</span> <span class="nf">set_role</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set the role using stdin stream. Timeout arg for slave() can be</span>
<span class="sd">    specified using a space delimiter (e.g. &#39;R 10&#39; calls `slave(10)`)</span>

<span class="sd">    :return:</span>
<span class="sd">        - True when role is complete &amp; app should continue running.</span>
<span class="sd">        - False when app should exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
        <span class="s2">&quot;*** Enter &#39;R&#39; for receiver role.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;*** Enter &#39;T&#39; for transmitter role.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;*** Enter &#39;Q&#39; to quit example.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;?&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
        <span class="n">master</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;is an unrecognized input. Please try again.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">set_role</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># parse any CLI args</span>

    <span class="c1"># initialize the nRF24L01 on the spi bus</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;radio hardware is not responding&quot;</span><span class="p">)</span>

    <span class="c1"># For this example, we will use different addresses</span>
    <span class="c1"># An address need to be a buffer protocol object (bytearray)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;1Node&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;2Node&quot;</span><span class="p">]</span>
    <span class="c1"># It is very helpful to think of an address as a path instead of as</span>
    <span class="c1"># an identifying device destination</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># print example name</span>

    <span class="c1"># to use different addresses on a pair of radios, we need a variable to</span>
    <span class="c1"># uniquely identify which address this radio will use to transmit</span>
    <span class="c1"># 0 uses address[0] to transmit, 1 uses address[1] to transmit</span>
    <span class="n">radio_number</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span>  <span class="c1"># uses default value from `parser`</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if &#39;--node&#39; arg wasn&#39;t specified</span>
        <span class="n">radio_number</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span>
                <span class="nb">input</span><span class="p">(</span>
                    <span class="s2">&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39; &quot;</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># ACK payloads are dynamically sized.</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setDynamicPayloads</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># to use ACK payloads</span>

    <span class="c1"># to enable the custom ACK payload feature</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">enableAckPayload</span><span class="p">()</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># set the TX address of the RX node into the TX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># always uses pipe 0</span>

    <span class="c1"># set the RX address of the TX node into a RX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="p">[</span><span class="ow">not</span> <span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># using pipe 1</span>

    <span class="c1"># for debugging</span>
    <span class="c1"># radio.printDetails()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if not specified with CLI arg &#39;-r&#39;</span>
            <span class="k">while</span> <span class="n">set_role</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># continue example until &#39;Q&#39; is entered</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if role was set using CLI args</span>
            <span class="c1"># run role once and exit</span>
            <span class="n">master</span><span class="p">()</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">role</span><span class="p">)</span> <span class="k">else</span> <span class="n">slave</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Keyboard Interrupt detected. Exiting...&quot;</span><span class="p">)</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="manual-acknowledgements-py">
<h2>manual_acknowledgements.py<a class="headerlink" href="#manual-acknowledgements-py" title="Permalink to this headline">¶</a></h2>
<p>This is a simple example of using the RF24 class on a Raspberry Pi to transmit and respond with acknowledgment (ACK) transmissions. Notice that the auto-ack feature is enabled, but this example doesn’t use automatic ACK payloads because automatic ACK payloads’ data will always be outdated by 1 transmission. Instead, this example uses a call and response paradigm.
This example was written to be used on 2 devices acting as “nodes”.
Remember to <a class="reference external" href="python_wrapper.html">install the Python wrapper</a>, then navigate to the “RF24/examples_linux” folder.
To run this example, enter</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 manual_acknowledgements.py
</pre></div>
</div>
<p>and follow the prompts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example requires python v3.7 or newer because it measures transmission time with <a class="reference external" href="https://docs.python.org/3.7/library/time.html#time.monotonic_ns">time.monotonic_ns()</a>.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> to quit at any time, but remember state the radio will persist until another example or application uses it.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">/examples_linux/manual_acknowledgements.py</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">RF24</span> <span class="kn">import</span> <span class="n">RF24</span><span class="p">,</span> <span class="n">RF24_PA_LOW</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--node&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the identifying radio number (or node ID number)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--role&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&#39;1&#39; specifies the TX role. &#39;0&#39; specifies the RX role.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">########### USER CONFIGURATION ###########</span>
<span class="c1"># See https://github.com/TMRh20/RF24/blob/master/pyRF24/readme.md</span>
<span class="c1"># Radio CE Pin, CSN Pin, SPI Speed</span>
<span class="c1"># CE Pin uses GPIO number with BCM and SPIDEV drivers, other platforms use</span>
<span class="c1"># their own pin numbering</span>
<span class="c1"># CS Pin addresses the SPI bus number at /dev/spidev&lt;a&gt;.&lt;b&gt;</span>
<span class="c1"># ie: RF24 radio(&lt;ce_pin&gt;, &lt;a&gt;*10+&lt;b&gt;); spidev1.0 is 10, spidev1.1 is 11 etc..</span>

<span class="c1"># Generic:</span>
<span class="n">radio</span> <span class="o">=</span> <span class="n">RF24</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">################## Linux (BBB,x86,etc) #########################</span>
<span class="c1"># See http://2bndy5.github.io/RF24/pages.html for more information on usage</span>
<span class="c1"># See http://iotdk.intel.com/docs/master/mraa/ for more information on MRAA</span>
<span class="c1"># See https://www.kernel.org/doc/Documentation/spi/spidev for more</span>
<span class="c1"># information on SPIDEV</span>

<span class="c1"># using the python keyword global is bad practice. Instead we&#39;ll use a 1 item</span>
<span class="c1"># list to store our integer number for the payloads&#39; counter</span>
<span class="n">counter</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">master</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Transmits a message and an incrementing integer every second, then</span>
<span class="sd">    wait for a response for up to 200 ms.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">failures</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="c1"># use bytes() to pack our counter data into the payload</span>
        <span class="c1"># NOTE b&quot;\x00&quot; byte is a c-string&#39;s NULL terminating 0</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;Hello </span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
        <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># start timer</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transmission failed or timed out&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio in RX mode</span>
            <span class="n">timout</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="mi">200</span>  <span class="c1"># use 200 ms timeout</span>
            <span class="c1"># declare a variable to save the incoming response</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">available</span><span class="p">()</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">&lt;</span> <span class="n">timout</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># wait for incoming payload or timeout</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
            <span class="n">end_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># end timer</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Transmission successful. Sent: </span><span class="si">{}{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">buffer</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">),</span>
                <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">has_payload</span><span class="p">,</span> <span class="n">pipe_number</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">available_pipe</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">has_payload</span><span class="p">:</span>
                <span class="c1"># grab the incoming payload</span>
                <span class="n">received</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">)</span>
                <span class="c1"># NOTE received[7:8] discards NULL terminating 0</span>
                <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># save the counter</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;Received </span><span class="si">{}</span><span class="s2"> bytes on pipe </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}{}</span><span class="s2">. &quot;</span>
                    <span class="s2">&quot;Round-trip delay: </span><span class="si">{}</span><span class="s2"> us.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">,</span>
                        <span class="n">pipe_number</span><span class="p">,</span>
                        <span class="nb">bytes</span><span class="p">(</span><span class="n">received</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                        <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">end_timer</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No response received.&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># make example readable by slowing down transmissions</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">failures</span><span class="p">,</span> <span class="s2">&quot;failures detected. Leaving TX role.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Listen for any payloads and print the transaction</span>

<span class="sd">    :param int timeout: The number of seconds to wait (with no transmission)</span>
<span class="sd">        until exiting function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio in RX mode</span>

    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># start a timer to detect timeout</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="c1"># receive `count` payloads or wait 6 seconds till timing out</span>
        <span class="n">has_payload</span><span class="p">,</span> <span class="n">pipe_number</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">available_pipe</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">has_payload</span><span class="p">:</span>
            <span class="n">received</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">)</span>  <span class="c1"># fetch the payload</span>
            <span class="c1"># NOTE received[7:8] discards NULL terminating 0</span>
            <span class="c1"># increment the counter from received payload</span>
            <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">255</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="c1"># use bytes() to pack our counter data into the payload</span>
            <span class="c1"># NOTE b&quot;\x00&quot; byte is a c-string&#39;s NULL terminating 0</span>
            <span class="n">buffer</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;World </span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
            <span class="n">start_response</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">buffer</span><span class="p">)</span>  <span class="c1"># send response</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_response</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="c1"># keep retrying to send response for 150 milliseconds</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">resend</span><span class="p">()</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio back in RX mode</span>
            <span class="c1"># print the payload received payload</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Received </span><span class="si">{}</span><span class="s2"> bytes on pipe </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">,</span>
                    <span class="n">pipe_number</span><span class="p">,</span>
                    <span class="nb">bytes</span><span class="p">(</span><span class="n">received</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
                    <span class="n">received</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="p">),</span>
                <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>  <span class="c1"># did response succeed?</span>
                <span class="c1"># print response&#39;s payload</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sent: </span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">buffer</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span> <span class="n">counter</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Response failed or timed out&quot;</span><span class="p">)</span>
            <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># reset the timeout timer</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing received in 6 seconds. Leaving RX role&quot;</span><span class="p">)</span>
    <span class="c1"># recommended behavior is to keep in TX mode while idle</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put the radio in TX mode</span>


<span class="k">def</span> <span class="nf">set_role</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set the role using stdin stream. Timeout arg for slave() can be</span>
<span class="sd">    specified using a space delimiter (e.g. &#39;R 10&#39; calls `slave(10)`)</span>

<span class="sd">    :return:</span>
<span class="sd">        - True when role is complete &amp; app should continue running.</span>
<span class="sd">        - False when app should exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">input</span><span class="p">(</span>
            <span class="s2">&quot;*** Enter &#39;R&#39; for receiver role.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;*** Enter &#39;T&#39; for transmitter role.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;*** Enter &#39;Q&#39; to quit example.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="ow">or</span> <span class="s2">&quot;?&quot;</span>
    <span class="p">)</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
        <span class="n">master</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;is an unrecognized input. Please try again.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">set_role</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># parse any CLI args</span>

    <span class="c1"># initialize the nRF24L01 on the spi bus</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;radio hardware is not responding&quot;</span><span class="p">)</span>

    <span class="c1"># For this example, we will use different addresses</span>
    <span class="c1"># An address need to be a buffer protocol object (bytearray)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;1Node&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;2Node&quot;</span><span class="p">]</span>
    <span class="c1"># It is very helpful to think of an address as a path instead of as</span>
    <span class="c1"># an identifying device destination</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># print example name</span>

    <span class="c1"># to use different addresses on a pair of radios, we need a variable to</span>
    <span class="c1"># uniquely identify which address this radio will use to transmit</span>
    <span class="c1"># 0 uses address[0] to transmit, 1 uses address[1] to transmit</span>
    <span class="n">radio_number</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span>  <span class="c1"># uses default value from `parser`</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if &#39;--node&#39; arg wasn&#39;t specified</span>
        <span class="n">radio_number</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># set the TX address of the RX node into the TX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># always uses pipe 0</span>

    <span class="c1"># set the RX address of the TX node into a RX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="p">[</span><span class="ow">not</span> <span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># using pipe 1</span>

    <span class="c1"># To save time during transmission, we&#39;ll set the payload size to be only</span>
    <span class="c1"># what we need. For this example, we&#39;ll be using a byte for the</span>
    <span class="c1"># payload counter and 7 bytes for the payload message</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="c1"># for debugging</span>
    <span class="c1"># radio.printDetails()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if not specified with CLI arg &#39;-r&#39;</span>
            <span class="k">while</span> <span class="n">set_role</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># continue example until &#39;Q&#39; is entered</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if role was set using CLI args</span>
            <span class="c1"># run role once and exit</span>
            <span class="n">master</span><span class="p">()</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">role</span><span class="p">)</span> <span class="k">else</span> <span class="n">slave</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Keyboard Interrupt detected. Exiting...&quot;</span><span class="p">)</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="multiceiver-demo-py">
<h2>multiceiver_demo.py<a class="headerlink" href="#multiceiver-demo-py" title="Permalink to this headline">¶</a></h2>
<p>A simple example of sending data from as many as 6 nRF24L01 transceivers to 1 receiving transceiver. This technique is trademarked by Nordic Semiconductors as “MultiCeiver”.
Remember to <a class="reference external" href="python_wrapper.html">install the Python wrapper</a>, then navigate to the “RF24/examples_linux” folder.
To run this example, enter</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 multiceiver_demo.py
</pre></div>
</div>
<p>and follow the prompts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example requires python v3.7 or newer because it measures transmission time with <a class="reference external" href="https://docs.python.org/3.7/library/time.html#time.monotonic_ns">time.monotonic_ns()</a>.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> to quit at any time, but remember state the radio will persist until another example or application uses it.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">/examples_linux/multiceiver_demo.py</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">from</span> <span class="nn">RF24</span> <span class="kn">import</span> <span class="n">RF24</span><span class="p">,</span> <span class="n">RF24_PA_LOW</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--node&quot;</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the identifying node ID number for the TX role. &quot;</span>
    <span class="s2">&quot;Use &#39;R&#39; or &#39;r&#39; to specify the RX role&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">########### USER CONFIGURATION ###########</span>
<span class="c1"># See https://github.com/TMRh20/RF24/blob/master/pyRF24/readme.md</span>
<span class="c1"># Radio CE Pin, CSN Pin, SPI Speed</span>
<span class="c1"># CE Pin uses GPIO number with BCM and SPIDEV drivers, other platforms use</span>
<span class="c1"># their own pin numbering</span>
<span class="c1"># CS Pin addresses the SPI bus number at /dev/spidev&lt;a&gt;.&lt;b&gt;</span>
<span class="c1"># ie: RF24 radio(&lt;ce_pin&gt;, &lt;a&gt;*10+&lt;b&gt;); spidev1.0 is 10, spidev1.1 is 11 etc..</span>

<span class="c1"># Generic:</span>
<span class="n">radio</span> <span class="o">=</span> <span class="n">RF24</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">################## Linux (BBB,x86,etc) #########################</span>
<span class="c1"># See http://2bndy5.github.io/RF24/pages.html for more information on usage</span>
<span class="c1"># See http://iotdk.intel.com/docs/master/mraa/ for more information on MRAA</span>
<span class="c1"># See https://www.kernel.org/doc/Documentation/spi/spidev for more</span>
<span class="c1"># information on SPIDEV</span>

<span class="c1"># setup the addresses for all transmitting radio nodes</span>
<span class="n">addresses</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x78</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span>
    <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xF1\xB6\xB5\xB4\xB3</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xCD\xB6\xB5\xB4\xB3</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xA3\xB6\xB5\xB4\xB3</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0F\xB6\xB5\xB4\xB3</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x05\xB6\xB5\xB4\xB3</span><span class="s2">&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="c1"># It is very helpful to think of an address as a path instead of as</span>
<span class="c1"># an identifying device destination</span>


<span class="k">def</span> <span class="nf">master</span><span class="p">(</span><span class="n">node_number</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;start transmitting to the base station.</span>

<span class="sd">    :param int node_number: the node&#39;s identifying index (from the</span>
<span class="sd">        the `addresses` list). This is a required parameter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
    <span class="c1"># set the TX address to the address of the base station.</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">addresses</span><span class="p">[</span><span class="n">node_number</span><span class="p">])</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">failures</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># payloads will include the node_number and a payload ID character</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;ii&quot;</span><span class="p">,</span> <span class="n">node_number</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
        <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
        <span class="n">end_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>
        <span class="c1"># show something to see it isn&#39;t frozen</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Transmission of payloadID </span><span class="si">{}</span><span class="s2"> as node </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">,</span> <span class="n">node_number</span><span class="p">),</span>
            <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">report</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;successfull! Time to transmit = </span><span class="si">{}</span><span class="s2"> us&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">end_timer</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;failed or timed out&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>  <span class="c1"># slow down the test for readability</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">failures</span><span class="p">,</span> <span class="s2">&quot;failures detected. Leaving TX role.&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use the radio as a base station for lisening to all nodes</span>

<span class="sd">    :param int timeout: The number of seconds to wait (with no transmission)</span>
<span class="sd">        until exiting function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># write the addresses to all pipes.</span>
    <span class="k">for</span> <span class="n">pipe_n</span><span class="p">,</span> <span class="n">addr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">addresses</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="n">pipe_n</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio in RX mode</span>
    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># start timer</span>
    <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timer</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="n">has_payload</span><span class="p">,</span> <span class="n">pipe_number</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">available_pipe</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">has_payload</span><span class="p">:</span>
            <span class="c1"># unpack payload</span>
            <span class="n">nodeID</span><span class="p">,</span> <span class="n">payloadID</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&lt;ii&quot;</span><span class="p">,</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">))</span>
            <span class="c1"># show the pipe number that received the payload</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Received </span><span class="si">{}</span><span class="s2"> bytes on pipe </span><span class="si">{}</span><span class="s2"> from node </span><span class="si">{}</span><span class="s2">. PayloadID: &quot;</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">,</span> <span class="n">pipe_number</span><span class="p">,</span> <span class="n">nodeID</span><span class="p">,</span> <span class="n">payloadID</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># reset timer with every payload</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing received in 6 seconds. Leaving RX role&quot;</span><span class="p">)</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">set_role</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set the role using stdin stream. Timeout arg for slave() can be</span>
<span class="sd">    specified using a space delimiter (e.g. &#39;R 10&#39; calls `slave(10)`)</span>

<span class="sd">    :return:</span>
<span class="sd">        - True when role is complete &amp; app should continue running.</span>
<span class="sd">        - False when app should exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">input</span><span class="p">(</span>
            <span class="s2">&quot;*** Enter &#39;R&#39; for receiver role.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;*** Enter a number in range [0, 5] to use a specific node ID for &quot;</span>
            <span class="s2">&quot;transmitter role.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;*** Enter &#39;Q&#39; to quit example.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="ow">or</span> <span class="s2">&quot;?&quot;</span>
    <span class="p">)</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">master</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;is an unrecognized input. Please try again.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">set_role</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># parse any CLI args</span>

    <span class="c1"># initialize the nRF24L01 on the spi bus</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;radio hardware is not responding&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># print example name</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># To save time during transmission, we&#39;ll set the payload size to be only what</span>
    <span class="c1"># we need.</span>
    <span class="c1"># 2 int occupy 8 bytes in memory using len(struct.pack())</span>
    <span class="c1"># &quot;&lt;ii&quot; means 2x little endian unsigned int</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&lt;ii&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

    <span class="c1"># for debugging</span>
    <span class="c1"># radio.printDetails()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if not specified with CLI arg &#39;-n&#39;</span>
            <span class="k">while</span> <span class="n">set_role</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># continue example until &#39;Q&#39; is entered</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if role was set using CLI args</span>
            <span class="c1"># run role once and exit</span>
            <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                <span class="n">master</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">node</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slave</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Keyboard Interrupt detected. Exiting...&quot;</span><span class="p">)</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="streaming-data-py">
<h2>streaming_data.py<a class="headerlink" href="#streaming-data-py" title="Permalink to this headline">¶</a></h2>
<p>This is a simple example of using the RF24 class on a Raspberry Pi for streaming multiple payloads.
This example was written to be used on 2 devices acting as “nodes”.
Remember to <a class="reference external" href="python_wrapper.html">install the Python wrapper</a>, then navigate to the “RF24/examples_linux” folder.
To run this example, enter</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 streaming_data.py
</pre></div>
</div>
<p>and follow the prompts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example requires python v3.7 or newer because it measures transmission time with <a class="reference external" href="https://docs.python.org/3.7/library/time.html#time.monotonic_ns">time.monotonic_ns()</a>.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> to quit at any time, but remember state the radio will persist until another example or application uses it.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">/examples_linux/streaming_data.py</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">RF24</span> <span class="kn">import</span> <span class="n">RF24</span><span class="p">,</span> <span class="n">RF24_PA_LOW</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span>
    <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--node&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the identifying radio number (or node ID number)&quot;</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--role&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&#39;1&#39; specifies the TX role. &#39;0&#39; specifies the RX role.&quot;</span>
<span class="p">)</span>

<span class="c1">########### USER CONFIGURATION ###########</span>
<span class="c1"># See https://github.com/TMRh20/RF24/blob/master/pyRF24/readme.md</span>
<span class="c1"># Radio CE Pin, CSN Pin, SPI Speed</span>
<span class="c1"># CE Pin uses GPIO number with BCM and SPIDEV drivers, other platforms use</span>
<span class="c1"># their own pin numbering</span>
<span class="c1"># CS Pin addresses the SPI bus number at /dev/spidev&lt;a&gt;.&lt;b&gt;</span>
<span class="c1"># ie: RF24 radio(&lt;ce_pin&gt;, &lt;a&gt;*10+&lt;b&gt;); spidev1.0 is 10, spidev1.1 is 11 etc..</span>

<span class="c1"># Generic:</span>
<span class="n">radio</span> <span class="o">=</span> <span class="n">RF24</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">################## Linux (BBB,x86,etc) #########################</span>
<span class="c1"># See http://2bndy5.github.io/RF24/pages.html for more information on usage</span>
<span class="c1"># See http://iotdk.intel.com/docs/master/mraa/ for more information on MRAA</span>
<span class="c1"># See https://www.kernel.org/doc/Documentation/spi/spidev for more</span>
<span class="c1"># information on SPIDEV</span>

<span class="c1"># Specify the number of bytes in the payload. This is also used to</span>
<span class="c1"># specify the number of payloads in 1 stream of data</span>
<span class="n">SIZE</span> <span class="o">=</span> <span class="mi">32</span>  <span class="c1"># this is the default maximum payload size</span>


<span class="k">def</span> <span class="nf">make_buffer</span><span class="p">(</span><span class="n">buf_iter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a dynamically created payloads</span>

<span class="sd">    :param int buf_iter: The position of the payload in the data stream</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># we&#39;ll use `SIZE` for the number of payloads in the list and the</span>
    <span class="c1"># payloads&#39; length</span>
    <span class="c1"># prefix payload with a sequential letter to indicate which</span>
    <span class="c1"># payloads were lost (if any)</span>
    <span class="n">buff</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">buf_iter</span> <span class="o">+</span> <span class="p">(</span><span class="mi">65</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">buf_iter</span> <span class="o">&lt;</span> <span class="mi">26</span> <span class="k">else</span> <span class="mi">71</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">char</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">((</span><span class="n">SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">buf_iter</span><span class="p">))</span>
        <span class="n">char</span> <span class="o">|=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">((</span><span class="n">SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">buf_iter</span><span class="p">))</span>
        <span class="n">buff</span> <span class="o">+=</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">char</span> <span class="o">+</span> <span class="mi">48</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">buff</span>


<span class="k">def</span> <span class="nf">master</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Uses all 3 levels of the TX FIFO to send a stream of data</span>

<span class="sd">    :param int count: how many times to transmit the stream of data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">flushTx</span><span class="p">()</span>  <span class="c1"># clear the TX FIFO so we can use all 3 levels</span>
    <span class="n">failures</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># keep track of manual retries</span>
    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># start timer</span>
    <span class="k">for</span> <span class="n">multiplier</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>  <span class="c1"># repeat transmit the same data stream</span>
        <span class="n">buf_iter</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># iterator of payloads for the while loop</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="n">make_buffer</span><span class="p">(</span><span class="n">buf_iter</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">buf_iter</span> <span class="o">&lt;</span> <span class="n">SIZE</span> <span class="ow">and</span> <span class="n">failures</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
             <span class="c1"># cycle through all the payloads</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">buf_iter</span> <span class="o">&lt;</span> <span class="n">SIZE</span><span class="p">:</span>
                <span class="n">buf_iter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">make_buffer</span><span class="p">(</span><span class="n">buf_iter</span><span class="p">)</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">radio</span><span class="o">.</span><span class="n">isFifo</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDf</span><span class="p">():</span>
                    <span class="n">failures</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># increment manual retry count</span>
                    <span class="n">radio</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">radio</span><span class="o">.</span><span class="n">clearStatusFlags</span><span class="p">()</span>
                    <span class="n">radio</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">failures</span> <span class="o">&gt;</span> <span class="mi">99</span> <span class="ow">and</span> <span class="n">buf_iter</span> <span class="o">&lt;</span> <span class="mi">7</span> <span class="ow">and</span> <span class="n">multiplier</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c1"># we need to prevent an infinite loop</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="s2">&quot;Too many failures detected. Aborting at payload &quot;</span><span class="p">,</span>
                        <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">multiplier</span> <span class="o">=</span> <span class="n">count</span>  <span class="c1"># be sure to exit the for loop</span>
                    <span class="k">break</span>  <span class="c1"># exit the while loop</span>
                <span class="c1"># radio.resend()  # resend payload in top level of TX FIFO</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">ce</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">end_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic_ns</span><span class="p">()</span>  <span class="c1"># end timer</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;Time to transmit data = </span><span class="si">{}</span><span class="s2"> us. Detected </span><span class="si">{}</span><span class="s2"> failures.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="p">(</span><span class="n">end_timer</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="n">failures</span>
        <span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Listen for any payloads and print them out (suffixed with received</span>
<span class="sd">    counter)</span>

<span class="sd">    :param int timeout: The number of seconds to wait (with no transmission)</span>
<span class="sd">        until exiting function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># put radio in RX mode</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># keep track of the number of received payloads</span>
    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># start timer</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timer</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">available</span><span class="p">():</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># retreive the received packet&#39;s payload</span>
            <span class="n">receive_payload</span> <span class="o">=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received: </span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">receive_payload</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
            <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># reset timer on every RX payload</span>

    <span class="c1"># recommended behavior is to keep in TX mode while idle</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put the radio in TX mode</span>


<span class="k">def</span> <span class="nf">set_role</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set the role using stdin stream. Role args can be specified using space</span>
<span class="sd">    delimiters (e.g. &#39;R 10&#39; calls `slave(10)` &amp; &#39;T 3&#39; calls `master(3)`)</span>

<span class="sd">    :return:</span>
<span class="sd">        - True when role is complete &amp; app should continue running.</span>
<span class="sd">        - False when app should exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
        <span class="s2">&quot;*** Enter &#39;R&#39; for receiver role.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;*** Enter &#39;T&#39; for transmitter role.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="s2">&quot;*** Enter &#39;Q&#39; to quit example.</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;?&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">master</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">master</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;is an unrecognized input. Please try again.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">set_role</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># parse any CLI args</span>

    <span class="c1"># initialize the nRF24L01 on the spi bus</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;radio hardware is not responding&quot;</span><span class="p">)</span>

    <span class="c1"># For this example, we will use different addresses</span>
    <span class="c1"># An address need to be a buffer protocol object (bytearray)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;1Node&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;2Node&quot;</span><span class="p">]</span>
    <span class="c1"># It is very helpful to think of an address as a path instead of as</span>
    <span class="c1"># an identifying device destination</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># print example name</span>

    <span class="c1"># to use different addresses on a pair of radios, we need a variable to</span>
    <span class="c1"># uniquely identify which address this radio will use to transmit</span>
    <span class="c1"># 0 uses address[0] to transmit, 1 uses address[1] to transmit</span>
    <span class="n">radio_number</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span>  <span class="c1"># uses default value from `parser`</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if &#39;--node&#39; arg wasn&#39;t specified</span>
        <span class="n">radio_number</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span>
                <span class="nb">input</span><span class="p">(</span>
                    <span class="s2">&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39; &quot;</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># set the TX address of the RX node into the TX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># always uses pipe 0</span>

    <span class="c1"># set the RX address of the TX node into a RX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="p">[</span><span class="ow">not</span> <span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># using pipe 1</span>

    <span class="c1"># To save time during transmission, we&#39;ll set the payload size to be only</span>
    <span class="c1"># what we need. For this example, we&#39;ll be using the default maximum 32</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">payloadSize</span> <span class="o">=</span> <span class="n">SIZE</span>

    <span class="c1"># for debugging</span>
    <span class="c1"># radio.printDetails()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if not specified with CLI arg &#39;-r&#39;</span>
            <span class="k">while</span> <span class="n">set_role</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># continue example until &#39;Q&#39; is entered</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if role was set using CLI args</span>
            <span class="c1"># run role once and exit</span>
            <span class="n">master</span><span class="p">()</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">role</span><span class="p">)</span> <span class="k">else</span> <span class="n">slave</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Keyboard Interrupt detected. Exiting...&quot;</span><span class="p">)</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="interrup-configure-py">
<h2>interrup_configure.py<a class="headerlink" href="#interrup-configure-py" title="Permalink to this headline">¶</a></h2>
<p>This is a simple example of using the RF24 class on a Raspberry Pi to detecting (and verifying) the IRQ (interrupt) pin on the nRF24L01.
This example was written to be used on 2 devices acting as “nodes”.
Remember to <a class="reference external" href="python_wrapper.html">install the Python wrapper</a>, then navigate to the “RF24/examples_linux” folder.
To run this example, enter</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>python3 interrup_configure.py
</pre></div>
</div>
<p>and follow the prompts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example requires python v3.7 or newer because it measures transmission time with <a class="reference external" href="https://docs.python.org/3.7/library/time.html#time.monotonic_ns">time.monotonic_ns()</a>.</p>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">ctrl+c</span></code> to quit at any time, but remember state the radio will persist until another example or application uses it.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">/examples_linux/interrupt_configure.py</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="k">as</span> <span class="nn">GPIO</span>
<span class="kn">from</span> <span class="nn">RF24</span> <span class="kn">import</span> <span class="n">RF24</span><span class="p">,</span> <span class="n">RF24_PA_LOW</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="vm">__doc__</span><span class="p">,</span> <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-n&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--node&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;the identifying radio number (or node ID number)&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s2">&quot;-r&quot;</span><span class="p">,</span>
    <span class="s2">&quot;--role&quot;</span><span class="p">,</span>
    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&#39;1&#39; specifies the TX role. &#39;0&#39; specifies the RX role.&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">########### USER CONFIGURATION ###########</span>
<span class="c1"># See https://github.com/TMRh20/RF24/blob/master/pyRF24/readme.md</span>
<span class="c1"># Radio CE Pin, CSN Pin, SPI Speed</span>
<span class="c1"># CE Pin uses GPIO number with BCM and SPIDEV drivers, other platforms use</span>
<span class="c1"># their own pin numbering</span>
<span class="c1"># CS Pin addresses the SPI bus number at /dev/spidev&lt;a&gt;.&lt;b&gt;</span>
<span class="c1"># ie: RF24 radio(&lt;ce_pin&gt;, &lt;a&gt;*10+&lt;b&gt;); spidev1.0 is 10, spidev1.1 is 11 etc..</span>

<span class="c1"># Generic:</span>
<span class="n">radio</span> <span class="o">=</span> <span class="n">RF24</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c1">################## Linux (BBB,x86,etc) #########################</span>
<span class="c1"># See http://2bndy5.github.io/RF24/pages.html for more information on usage</span>
<span class="c1"># See http://iotdk.intel.com/docs/master/mraa/ for more information on MRAA</span>
<span class="c1"># See https://www.kernel.org/doc/Documentation/spi/spidev for more</span>
<span class="c1"># information on SPIDEV</span>

<span class="c1"># select your digital input pin that&#39;s connected to the IRQ pin on the nRF24L01</span>
<span class="n">IRQ_PIN</span> <span class="o">=</span> <span class="mi">12</span>

<span class="c1"># For this example, we&#39;ll be using a payload containing</span>
<span class="c1"># a string that changes on every transmission. (successful or not)</span>
<span class="c1"># Make a couple tuples of payloads &amp; an iterator to traverse them</span>
<span class="n">pl_iterator</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># use a 1-item list instead of python&#39;s global keyword</span>
<span class="n">tx_payloads</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Ping &quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;Pong &quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;Radio&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;1FAIL&quot;</span><span class="p">)</span>
<span class="n">ack_payloads</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s2">&quot;Yak &quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;Back&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot; ACK&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">interrupt_handler</span><span class="p">(</span><span class="n">channel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function is called when IRQ pin is detected active LOW&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IRQ pin&quot;</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="s2">&quot;went active LOW.&quot;</span><span class="p">)</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">clearStatusFlags</span><span class="p">()</span>  <span class="c1"># get IRQ status flags</span>
    <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDf</span><span class="p">():</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">flushTx</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;\dataReady: </span><span class="si">{}</span><span class="s2">, dataFail: </span><span class="si">{}</span><span class="s2">, dataSent: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">radio</span><span class="o">.</span><span class="n">irqDs</span><span class="p">(),</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDf</span><span class="p">(),</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDr</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">pl_iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;    &#39;data ready&#39; event test </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;passed&quot;</span> <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDr</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;failed&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">pl_iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;    &#39;data sent&#39; event test </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;passed&quot;</span> <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDs</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;failed&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">pl_iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;    &#39;data fail&#39; event test </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s2">&quot;passed&quot;</span> <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">irqDf</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;failed&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>


<span class="c1"># setup IRQ GPIO pin</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BCM</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">IRQ_PIN</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">IN</span><span class="p">,</span> <span class="n">pull_up_down</span><span class="o">=</span><span class="n">GPIO</span><span class="o">.</span><span class="n">PUD_UP</span><span class="p">)</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">add_event_detect</span><span class="p">(</span><span class="n">IRQ_PIN</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">FALLING</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">interrupt_handler</span><span class="p">)</span>
<span class="c1"># IMPORTANT: do not call radio.available() before calling</span>
<span class="c1"># radio.clearStatusFlags() when the interruptHandler() is triggered by the</span>
<span class="c1"># IRQ pin FALLING event. According to the datasheet, the pipe information</span>
<span class="c1"># is unreliable during the IRQ pin FALLING transition.</span>


<span class="k">def</span> <span class="nf">_ping_n_wait</span><span class="p">(</span><span class="n">pl_iter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;private function to ping RX node and wait for IRQ pin to be handled</span>

<span class="sd">    :param int pl_iter: The index of the buffer in `tx_payloads` tuple to</span>
<span class="sd">        send. This number is also used to determine if event test was</span>
<span class="sd">        successful or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set pl_iterator[0] so interrupt_handler() can determine if test was</span>
    <span class="c1"># successful or not</span>
    <span class="n">pl_iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pl_iter</span>
    <span class="c1"># the following False parameter means we&#39;re expecting an ACK packet</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tx_payloads</span><span class="p">[</span><span class="n">pl_iter</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># wait 100 ms for interrupt_handler() to complete</span>


<span class="k">def</span> <span class="nf">print_rx_fifo</span><span class="p">(</span><span class="n">pl_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;fush RX FIFO by printing all available payloads with 1 buffer</span>

<span class="sd">    :param int pl_size: the expected size of each payload</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">isFifo</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
        <span class="c1"># all 3 payloads received were 5 bytes each, and RX FIFO is full</span>
        <span class="c1"># so, fetching 15 bytes from the RX FIFO also flushes RX FIFO</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complete RX FIFO:&quot;</span><span class="p">,</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pl_size</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">radio</span><span class="o">.</span><span class="n">available</span><span class="p">():</span>
            <span class="n">buffer</span> <span class="o">+=</span> <span class="n">radio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">pl_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">buffer</span><span class="p">:</span>  <span class="c1"># if any payloads were read from the RX FIFO</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complete RX FIFO:&quot;</span><span class="p">,</span> <span class="n">buffer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">master</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Transmits 4 times and reports results</span>

<span class="sd">    1. successfully receive ACK payload first</span>
<span class="sd">    2. successfully transmit on second</span>
<span class="sd">    3. send a third payload to fill RX node&#39;s RX FIFO</span>
<span class="sd">       (supposedly making RX node unresponsive)</span>
<span class="sd">    4. intentionally fail transmit on the fourth</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode</span>

    <span class="c1"># on data ready test</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuring IRQ pin to only ignore &#39;on data sent&#39; event&quot;</span><span class="p">)</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">interruptConfig</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># args = dataReady, dataSent, dataFail</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Pinging slave node for an ACK payload...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">_ping_n_wait</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># on &quot;data sent&quot; test</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuring IRQ pin to only ignore &#39;on data ready&#39; event&quot;</span><span class="p">)</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">interruptConfig</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># args = dataReady, dataSent, dataFail</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Pinging slave node again...             &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">_ping_n_wait</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># trigger slave node to stopListening() by filling slave node&#39;s RX FIFO</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sending one extra payload to fill RX FIFO on slave node.&quot;</span><span class="p">)</span>
    <span class="c1"># disable IRQ pin for this step</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">interruptConfig</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">tx_payloads</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
        <span class="c1"># when send_only parameter is True, send() ignores RX FIFO usage</span>
        <span class="k">if</span> <span class="n">radio</span><span class="o">.</span><span class="n">isFifo</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RX node&#39;s FIFO is full; it is not listening any more&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Transmission successful, but the RX node might still be &quot;</span> <span class="s2">&quot;listening.&quot;</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">flushTx</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transmission failed or timed out. Continuing anyway.&quot;</span><span class="p">)</span>

    <span class="c1"># on &quot;data fail&quot; test</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Configuring IRQ pin to go active for all events.&quot;</span><span class="p">)</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">interruptConfig</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># args = dataReady, dataSent, dataFail</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Sending a ping to inactive slave node...&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
    <span class="n">_ping_n_wait</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># CE pin is still HIGH which consumes more power. Example is now idling so...</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># ensure CE pin is LOW</span>
    <span class="c1"># stopListening() also calls flushTx() when ACK payloads are enabled</span>

    <span class="n">print_rx_fifo</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ack_payloads</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># empty RX FIFO</span>


<span class="k">def</span> <span class="nf">slave</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>  <span class="c1"># will listen for 6 seconds before timing out</span>
    <span class="sd">&quot;&quot;&quot;Only listen for 3 payload from the master node</span>

<span class="sd">    :param int timeout: The number of seconds to wait (with no transmission)</span>
<span class="sd">        until exiting function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pl_iterator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># reset this to indicate event is a &#39;data_ready&#39; event</span>
    <span class="c1"># setup radio to recieve pings, fill TX FIFO with ACK payloads</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">writeAck</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ack_payloads</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">writeAck</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ack_payloads</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">writeAck</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ack_payloads</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">startListening</span><span class="p">()</span>  <span class="c1"># start listening &amp; clear status flags</span>
    <span class="n">start_timer</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span>  <span class="c1"># start timer now</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">isFifo</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timer</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
        <span class="c1"># if RX FIFO is not full and timeout is not reached, then keep waiting</span>
        <span class="k">pass</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># wait for last ACK payload to transmit</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">stopListening</span><span class="p">()</span>  <span class="c1"># put radio in TX mode &amp; discard any ACK payloads</span>
    <span class="n">print_rx_fifo</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_payloads</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>


<span class="k">def</span> <span class="nf">set_role</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Set the role using stdin stream. Timeout arg for slave() can be</span>
<span class="sd">    specified using a space delimiter (e.g. &#39;R 10&#39; calls `slave(10)`)</span>

<span class="sd">    :return:</span>
<span class="sd">        - True when role is complete &amp; app should continue running.</span>
<span class="sd">        - False when app should exit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="p">(</span>
        <span class="nb">input</span><span class="p">(</span>
            <span class="s2">&quot;*** Enter &#39;R&#39; for receiver role.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;*** Enter &#39;T&#39; for transmitter role.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;*** Enter &#39;Q&#39; to quit example.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="ow">or</span> <span class="s2">&quot;?&quot;</span>
    <span class="p">)</span>
    <span class="n">user_input</span> <span class="o">=</span> <span class="n">user_input</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_input</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slave</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
        <span class="n">master</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">):</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">user_input</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;is an unrecognized input. Please try again.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">set_role</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>  <span class="c1"># parse any CLI args</span>

    <span class="c1"># initialize the nRF24L01 on the spi bus</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">radio</span><span class="o">.</span><span class="n">begin</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;radio hardware is not responding&quot;</span><span class="p">)</span>

    <span class="c1"># For this example, we will use different addresses</span>
    <span class="c1"># An address need to be a buffer protocol object (bytearray)</span>
    <span class="n">address</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="s2">&quot;1Node&quot;</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&quot;2Node&quot;</span><span class="p">]</span>
    <span class="c1"># It is very helpful to think of an address as a path instead of as</span>
    <span class="c1"># an identifying device destination</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># print example name</span>

    <span class="c1"># to use different addresses on a pair of radios, we need a variable to</span>
    <span class="c1"># uniquely identify which address this radio will use to transmit</span>
    <span class="c1"># 0 uses address[0] to transmit, 1 uses address[1] to transmit</span>
    <span class="n">radio_number</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span>  <span class="c1"># uses default value from `parser`</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if &#39;--node&#39; arg wasn&#39;t specified</span>
        <span class="n">radio_number</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which radio is this? Enter &#39;0&#39; or &#39;1&#39;. Defaults to &#39;0&#39; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="c1"># set the Power Amplifier level to -12 dBm since this test example is</span>
    <span class="c1"># usually run with nRF24L01 transceivers in close proximity of each other</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setPaLevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">)</span>  <span class="c1"># RF24_PA_MAX is default</span>

    <span class="c1"># ACK payloads are dynamically sized.</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">setDynamicPayloads</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># to use ACK payloads</span>

    <span class="c1"># this example uses the ACK payload to trigger the IRQ pin active for</span>
    <span class="c1"># the &quot;on data received&quot; event</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">enableAckPayload</span><span class="p">()</span>  <span class="c1"># enable ACK payloads</span>

    <span class="c1"># set the TX address of the RX node into the TX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># always uses pipe 0</span>

    <span class="c1"># set the RX address of the TX node into a RX pipe</span>
    <span class="n">radio</span><span class="o">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="p">[</span><span class="ow">not</span> <span class="n">radio_number</span><span class="p">])</span>  <span class="c1"># using pipe 1</span>

    <span class="c1"># for debugging</span>
    <span class="c1"># radio.printDetails()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">role</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># if not specified with CLI arg &#39;-r&#39;</span>
            <span class="k">while</span> <span class="n">set_role</span><span class="p">():</span>
                <span class="k">pass</span>  <span class="c1"># continue example until &#39;Q&#39; is entered</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if role was set using CLI args</span>
            <span class="c1"># run role once and exit</span>
            <span class="n">master</span><span class="p">()</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">role</span><span class="p">)</span> <span class="k">else</span> <span class="n">slave</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; Keyboard Interrupt detected. Exiting...&quot;</span><span class="p">)</span>
        <span class="n">radio</span><span class="o">.</span><span class="n">powerDown</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="attiny_examples.html" class="btn btn-neutral float-right" title="ATTiny examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cpp_examples.html" class="btn btn-neutral float-left" title="Linux examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, 2bndy5

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>