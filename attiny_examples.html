

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ATTiny examples &mdash; RF24 Revemped 2.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/darkness.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Basic API" href="basic_api.html" />
    <link rel="prev" title="Python Wrapper examples" href="py_examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> RF24 Revemped
          

          
            
            <img src="_static/Logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ino_examples.html">Arduino examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpp_examples.html">Linux examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="py_examples.html">Python Wrapper examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ATTiny examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#rf24ping85">rf24ping85</a></li>
<li class="toctree-l2"><a class="reference internal" href="#timingsearch3pin">timingSearch3pin</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="basic_api.html">Basic API</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced_api.html">Advanced API</a></li>
<li class="toctree-l1"><a class="reference internal" href="configure_api.html">Configuration API</a></li>
</ul>
<p class="caption"><span class="caption-text">Related Pages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="common_issues.html">Common Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="arduino.html">Arduino</a></li>
<li class="toctree-l1"><a class="reference internal" href="attiny.html">ATTiny Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="linux_install.html">Linux Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="mraa.html">MRAA</a></li>
<li class="toctree-l1"><a class="reference internal" href="rpi_general.html">General Linux/Raspberry Pi</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_wrapper.html">Python Wrapper Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="cross_compilation.html">Linux cross-compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="atxmega.html">ATXMEGA</a></li>
<li class="toctree-l1"><a class="reference internal" href="portability.html">RF24 Portability</a></li>
<li class="toctree-l1"><a class="reference internal" href="templates.html">Templated Files for Platform Support</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RF24 Revemped</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ATTiny examples</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/attiny_examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="attiny-examples">
<h1>ATTiny examples<a class="headerlink" href="#attiny-examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="rf24ping85">
<h2>rf24ping85<a class="headerlink" href="#rf24ping85" title="Permalink to this headline">¶</a></h2>
<p>2014 Contribution by <a class="reference external" href="https://github.com/tong67">tong67</a></p>
<p>Updated 2020 by <a class="reference external" href="http://github.com/2bndy5">2bndy5</a> for the
<a class="reference external" href="https://github.com/SpenceKonde/ATTinyCore">SpenceKonde ATTinyCore</a></p>
<p>The RF24 library uses the <a class="reference external" href="https://github.com/SpenceKonde/ATTinyCore">ATTinyCore by SpenceKonde</a></p>
<p>This sketch is a duplicate of the <a class="reference external" href="ino_examples.html#manualacknowledgements-ino">ManualAcknowledgements.ino example</a>
(without all the Serial input/output code), and it demonstrates
a ATTiny25/45/85 or ATTiny24/44/84 driving the nRF24L01 transceiver using
the RF24 class to communicate with another node.</p>
<p>A simple example of sending data from 1 nRF24L01 transceiver to another
with manually transmitted (non-automatic) Acknowledgement (ACK) payloads.
This example still uses ACK packets, but they have no payloads. Instead the
acknowledging response is sent with <a class="reference internal" href="basic_api.html#_CPPv4N4RF244sendEPKv7uint8_t" title="RF24::send"><code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">RF24::send()</span></code></a>. This tactic allows
for more updated acknowledgement payload data, where actual ACK payloads’ data
are outdated by 1 transmission because they have to loaded before receiving a
transmission.</p>
<p>This example was written to be used on 2 devices acting as “nodes”.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">/examples/rf24_ATTiny/rf24ping85/rf24ping85.ino</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;SPI.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;RF24.h&quot;</span><span class="cp"></span>

<span class="c1">// CE and CSN are configurable, specified values for ATTiny85 as connected above</span>
<span class="cp">#define CE_PIN 3</span>
<span class="cp">#define CSN_PIN 4</span>
<span class="c1">//#define CSN_PIN 3 // uncomment for ATTiny85 3 pins solution</span>

<span class="c1">// instantiate an object for the nRF24L01 transceiver</span>
<span class="n">RF24</span> <span class="nf">radio</span><span class="p">(</span><span class="n">CE_PIN</span><span class="p">,</span> <span class="n">CSN_PIN</span><span class="p">);</span>

<span class="c1">// Let these addresses be used for the pair</span>
<span class="kt">uint8_t</span> <span class="n">address</span><span class="p">[][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;1Node&quot;</span><span class="p">,</span> <span class="s">&quot;2Node&quot;</span><span class="p">};</span>
<span class="c1">// It is very helpful to think of an address as a path instead of as</span>
<span class="c1">// an identifying device destination</span>

<span class="c1">// to use different addresses on a pair of radios, we need a variable to</span>
<span class="c1">// uniquely identify which address this radio will use to transmit</span>
<span class="kt">bool</span> <span class="n">radioNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 0 uses address[0] to transmit, 1 uses address[1] to transmit</span>

<span class="c1">// Used to control whether this node is sending or receiving</span>
<span class="kt">bool</span> <span class="n">role</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>  <span class="c1">// true = TX node, false = RX node</span>

<span class="c1">// For this example, we&#39;ll be using a payload containing</span>
<span class="c1">// a string &amp; an integer number that will be incremented</span>
<span class="c1">// on every successful transmission.</span>
<span class="c1">// Make a data structure to store the entire payload of different datatypes</span>
<span class="k">struct</span> <span class="nc">PayloadStruct</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">message</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>          <span class="c1">// only using 6 characters for TX &amp; RX payloads</span>
  <span class="kt">uint8_t</span> <span class="n">counter</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">PayloadStruct</span> <span class="n">payload</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>

  <span class="c1">// append a NULL terminating character for printing as a c-string</span>
  <span class="n">payload</span><span class="p">.</span><span class="n">message</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// initialize the transceiver on the SPI bus</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">radio</span><span class="p">.</span><span class="n">begin</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// hold in infinite loop</span>
  <span class="p">}</span>

  <span class="c1">// Set the PA Level low to try preventing power supply related problems</span>
  <span class="c1">// because these examples are likely run with nodes in close proximity to</span>
  <span class="c1">// each other.</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">setPALevel</span><span class="p">(</span><span class="n">RF24_PA_LOW</span><span class="p">);</span> <span class="c1">// RF24_PA_MAX is default.</span>

  <span class="c1">// save on transmission time by setting the radio to only transmit the</span>
  <span class="c1">// number of bytes we need to transmit a float</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">setPayloadLength</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">payload</span><span class="p">));</span> <span class="c1">// char[7] &amp; uint8_t datatypes occupy 8 bytes</span>

  <span class="c1">// set the TX address of the RX node into the TX pipe</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">openWritingPipe</span><span class="p">(</span><span class="n">address</span><span class="p">[</span><span class="n">radioNumber</span><span class="p">]);</span>     <span class="c1">// always uses pipe 0</span>

  <span class="c1">// set the RX address of the TX node into a RX pipe</span>
  <span class="n">radio</span><span class="p">.</span><span class="n">openReadingPipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">address</span><span class="p">[</span><span class="o">!</span><span class="n">radioNumber</span><span class="p">]);</span> <span class="c1">// using pipe 1</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">role</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// setup the TX node</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Hello &quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// set the outgoing message</span>
    <span class="n">radio</span><span class="p">.</span><span class="n">stopListening</span><span class="p">();</span>                <span class="c1">// put radio in TX mode</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// setup the RX node</span>

    <span class="n">memcpy</span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;World &quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span> <span class="c1">// set the outgoing message</span>
    <span class="n">radio</span><span class="p">.</span><span class="n">startListening</span><span class="p">();</span>               <span class="c1">// put radio in RX mode</span>
  <span class="p">}</span>
<span class="p">}</span> <span class="c1">// setup()</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">role</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This device is a TX node</span>

    <span class="kt">bool</span> <span class="n">report</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">payload</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">payload</span><span class="p">));</span> <span class="c1">// transmit &amp; save the report</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">report</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// transmission successful; wait for response and print results</span>

      <span class="n">radio</span><span class="p">.</span><span class="n">startListening</span><span class="p">();</span>                    <span class="c1">// put in RX mode</span>
      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start_timeout</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>    <span class="c1">// timer to detect no response</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">radio</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// wait for response or timeout</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_timeout</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">)</span>      <span class="c1">// only wait 200 ms</span>
          <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">radio</span><span class="p">.</span><span class="n">stopListening</span><span class="p">();</span>                     <span class="c1">// put back in TX mode</span>

      <span class="c1">// print summary of transactions</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">radio</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>                   <span class="c1">// is there a payload received?</span>

        <span class="n">PayloadStruct</span> <span class="n">received</span><span class="p">;</span>
        <span class="n">radio</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">received</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">received</span><span class="p">));</span> <span class="c1">// get payload from RX FIFO</span>
        <span class="n">payload</span><span class="p">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">received</span><span class="p">.</span><span class="n">counter</span><span class="p">;</span>      <span class="c1">// save incoming counter for next outgoing counter</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// report</span>

    <span class="c1">// to make this example readable in the serial monitor</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>  <span class="c1">// slow transmissions down by 1 second</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// This device is a RX node</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">radio</span><span class="p">.</span><span class="n">available</span><span class="p">())</span> <span class="p">{</span>                      <span class="c1">// is there a payload?</span>

      <span class="n">PayloadStruct</span> <span class="n">received</span><span class="p">;</span>
      <span class="n">radio</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">received</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">received</span><span class="p">));</span>    <span class="c1">// get incoming payload</span>
      <span class="n">payload</span><span class="p">.</span><span class="n">counter</span> <span class="o">=</span> <span class="n">received</span><span class="p">.</span><span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>     <span class="c1">// increment incoming counter for next outgoing response</span>

      <span class="c1">// transmit response &amp; save result to `report`</span>
      <span class="n">radio</span><span class="p">.</span><span class="n">stopListening</span><span class="p">();</span>                      <span class="c1">// put in TX mode</span>

      <span class="kt">bool</span> <span class="n">report</span> <span class="o">=</span> <span class="n">radio</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="o">&amp;</span><span class="n">payload</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">payload</span><span class="p">));</span> <span class="c1">// load response to TX FIFO</span>

      <span class="n">radio</span><span class="p">.</span><span class="n">startListening</span><span class="p">();</span>                     <span class="c1">// put back in RX mode</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="c1">// role</span>
<span class="p">}</span> <span class="c1">// loop</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="timingsearch3pin">
<h2>timingSearch3pin<a class="headerlink" href="#timingsearch3pin" title="Permalink to this headline">¶</a></h2>
<p>2014 Contribution by <a class="reference external" href="https://github.com/tong67">tong67</a></p>
<p>Updated 2020 by <a class="reference external" href="http://github.com/2bndy5">2bndy5</a> for the
<a class="reference external" href="https://github.com/SpenceKonde/ATTinyCore">SpenceKonde ATTinyCore</a></p>
<p>The RF24 library uses the <a class="reference external" href="https://github.com/SpenceKonde/ATTinyCore">ATTinyCore by SpenceKonde</a></p>
<p>This sketch can determine the best settle time values to use for
macros, defined as <code class="docutils literal notranslate"><span class="pre">RF24_CSN_SETTLE_HIGH_DELAY</span></code> and <code class="docutils literal notranslate"><span class="pre">RF24_CSN_SETTLE_LOW_DELAY</span></code>,
<code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">RF24::csDelay</span></code> in RF24::csn() (private function).</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><code class="xref cpp cpp-var docutils literal notranslate"><span class="pre">RF24::csDelay</span></code></p>
</div>
<p>The settle time values used here are 100/20. However, these values depend
on the actual used RC combiniation and voltage drop by LED. The
intermediate results are written to TX (PB3, pin 2 – using Serial).</p>
<p>For schematic details, see introductory comment block in the rf24ping85.ino sketch.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">/examples/rf24_ATTiny/timingSearch3pin/timingSearch3pin.ino</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;SPI.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Arduino.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;nRF24L01.h&gt;</span><span class="cp"></span>


<span class="cp">#if defined (ARDUINO) &amp;&amp; !defined (__arm__)</span>
<span class="cp">#if defined(__AVR_ATtinyX5__) || defined(__AVR_ATtinyX4__)</span>
<span class="cp">#define RF24_TINY</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cm">/****************************************************************************/</span>

<span class="cp">#if defined(RF24_TINY)</span>

<span class="c1">// when Attiny84 or Attiny85 is detected</span>
<span class="cp">#define CE_PIN   3 </span><span class="cm">/** &quot;Chip Enable&quot; pin, activates the RX or TX role */</span><span class="cp"></span>
<span class="cp">#define CSN_PIN  3 </span><span class="cm">/** SPI Chip Select Not */</span><span class="cp"></span>

<span class="cp">#else</span>
<span class="c1">// when not running on an ATTiny84 or ATTiny85</span>
<span class="cp">#define CE_PIN   7 </span><span class="cm">/** &quot;Chip Enable&quot; pin, activates the RX or TX role */</span><span class="cp"></span>
<span class="cp">#define CSN_PIN  8 </span><span class="cm">/** SPI Chip Select Not */</span><span class="cp"></span>

<span class="cp">#endif</span>

<span class="cp">#define MAX_HIGH	100</span>
<span class="cp">#define MAX_LOW		100</span>
<span class="cp">#define MINIMAL		8</span>

<span class="c1">// Use these adjustable variables to test for best configuration to be used on</span>
<span class="c1">// the ATTiny chips. These variables are defined as macros in the library&#39;s</span>
<span class="c1">// RF24/utility/ATTiny/RF24_arch_config.h file. To change them, simply define</span>
<span class="c1">// the corresponding macro(s) before #include &lt;RF24&gt; in your sketch.</span>
<span class="kt">uint8_t</span> <span class="n">csnHighSettle</span> <span class="o">=</span> <span class="n">MAX_HIGH</span><span class="p">;</span> <span class="c1">// defined as RF24_CSN_SETTLE_HIGH_DELAY</span>
<span class="kt">uint8_t</span> <span class="n">csnLowSettle</span> <span class="o">=</span> <span class="n">MAX_LOW</span><span class="p">;</span>   <span class="c1">// defined as RF24_CSN_SETTLE_LOW_DELAY</span>

<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">ce</span><span class="p">(</span><span class="kt">bool</span> <span class="n">level</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">CE_PIN</span> <span class="o">!=</span> <span class="n">CSN_PIN</span><span class="p">)</span> <span class="n">digitalWrite</span><span class="p">(</span><span class="n">CE_PIN</span><span class="p">,</span> <span class="n">level</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">csn</span><span class="p">(</span><span class="kt">bool</span> <span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">CE_PIN</span> <span class="o">!=</span> <span class="n">CSN_PIN</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">CSN_PIN</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// digitalWrite(SCK, mode);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="n">HIGH</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">PORTB</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">PINB2</span><span class="p">);</span> <span class="c1">// SCK-&gt;CSN HIGH</span>
      <span class="n">delayMicroseconds</span><span class="p">(</span><span class="n">csnHighSettle</span><span class="p">);</span> <span class="c1">// allow csn to settle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">PORTB</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">PINB2</span><span class="p">);</span> <span class="c1">// SCK-&gt;CSN LOW</span>
      <span class="n">delayMicroseconds</span><span class="p">(</span><span class="n">csnLowSettle</span><span class="p">);</span>  <span class="c1">// allow csn to settle</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="kt">uint8_t</span> <span class="nf">read_register</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">csn</span><span class="p">(</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">R_REGISTER</span> <span class="o">|</span> <span class="n">reg</span><span class="p">);</span>
  <span class="kt">uint8_t</span> <span class="n">result</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="mh">0xff</span><span class="p">);</span>
  <span class="n">csn</span><span class="p">(</span><span class="n">HIGH</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">write_register</span><span class="p">(</span><span class="kt">uint8_t</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">csn</span><span class="p">(</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">W_REGISTER</span> <span class="o">|</span> <span class="n">reg</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">transfer</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
  <span class="n">csn</span><span class="p">(</span><span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************/</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>

<span class="cp">#ifndef __AVR_ATtinyX313__</span>
  <span class="c1">// not enough memory on ATTiny4313 or ATTint2313(a) to use Serial I/O for this sketch</span>

  <span class="c1">// start serial port and SPI</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">SPI</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="c1">// configure CE and CSN as output when used</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">CE_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">CSN_PIN</span> <span class="o">!=</span> <span class="n">CE_PIN</span><span class="p">)</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">CSN_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>

  <span class="c1">// csn is used in SPI transfers. Set to LOW at start and HIGH after transfer. Set to HIGH to reflect no transfer active</span>
  <span class="c1">// SPI command are accepted in Power Down state.</span>
  <span class="c1">// CE pin represent PRX (LOW) or PTX (HIGH) mode apart from register settings. Start in PRX mode.</span>
  <span class="n">ce</span><span class="p">(</span><span class="n">LOW</span><span class="p">);</span>
  <span class="n">csn</span><span class="p">(</span><span class="n">HIGH</span><span class="p">);</span>

  <span class="c1">// nRF24L01 goes from to Power Down state 100ms after Power on Reset ( Vdd &gt; 1.9V) or when PWR_UP is 0 in config register</span>
  <span class="c1">// Goto Power Down state (Powerup or force) and set in transmit mode</span>
  <span class="n">write_register</span><span class="p">(</span><span class="n">NRF_CONFIG</span><span class="p">,</span> <span class="n">read_register</span><span class="p">(</span><span class="n">NRF_CONFIG</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">_BV</span><span class="p">(</span><span class="n">PWR_UP</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">_BV</span><span class="p">(</span><span class="n">PRIM_RX</span><span class="p">));</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

  <span class="c1">// Goto Standby-I</span>
  <span class="c1">// Technically we require 4.5ms Tpd2stby+ 14us as a worst case. We&#39;ll just call it 5ms for good measure.</span>
  <span class="c1">// WARNING: Delay is based on P-variant whereby non-P *may* require different timing.</span>
  <span class="n">write_register</span><span class="p">(</span><span class="n">NRF_CONFIG</span><span class="p">,</span> <span class="n">read_register</span><span class="p">(</span><span class="n">NRF_CONFIG</span><span class="p">)</span> <span class="o">|</span> <span class="n">_BV</span><span class="p">(</span><span class="n">PWR_UP</span><span class="p">));</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">;</span>

  <span class="c1">// Goto Standby-II</span>
  <span class="n">ce</span><span class="p">(</span><span class="n">HIGH</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Scanning for optimal setting time for csn&quot;</span><span class="p">);</span>


  <span class="cm">/************************** Main program *********************************/</span>

  <span class="kt">uint8_t</span> <span class="n">result</span><span class="p">;</span> <span class="c1">// used to compare read/write results with read/write cmds</span>
  <span class="kt">bool</span> <span class="n">success</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">bottom_success</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">bottom_found</span><span class="p">;</span>
  <span class="kt">uint8_t</span> <span class="n">value</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">};</span>
  <span class="kt">uint8_t</span> <span class="n">limit</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">MAX_HIGH</span><span class="p">,</span> <span class="n">MAX_LOW</span><span class="p">};</span>
  <span class="kt">uint8_t</span> <span class="n">advice</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">MAX_HIGH</span><span class="p">,</span> <span class="n">MAX_LOW</span><span class="p">};</span>

  <span class="c1">// check max values give correct behavior</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bottom_found</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">bottom_success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">bottom_success</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">csnHighSettle</span> <span class="o">=</span> <span class="n">limit</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="n">csnLowSettle</span> <span class="o">=</span> <span class="n">limit</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      <span class="c1">// check current values</span>
      <span class="kt">uint8_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">255</span> <span class="o">&amp;&amp;</span> <span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">uint8_t</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">write_register</span><span class="p">(</span><span class="n">EN_AA</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
          <span class="n">result</span> <span class="o">=</span> <span class="n">read_register</span><span class="p">(</span><span class="n">EN_AA</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">!=</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">success</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// process result of current values</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Settle Not OK. csnHigh=&quot;</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; csnLow=&quot;</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>
        <span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
        <span class="n">bottom_found</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">bottom_success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Settle OK. csnHigh=&quot;</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; csnLow=&quot;</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bottom_found</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">--</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">MINIMAL</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">bottom_found</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="n">bottom_success</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">success</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="n">bottom_success</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">// while (bottom_success &lt; 255)</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Settle value found for &quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;csnHigh: &quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;csnLow: &quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>
    <span class="n">advice</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">);</span>
    <span class="n">limit</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
  <span class="p">}</span> <span class="c1">// for (uint8_t k = 0; k &lt; 2; k++)</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Advised Settle times are: csnHigh=&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">advice</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot; csnLow=&quot;</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">advice</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">DEC</span><span class="p">);</span>

<span class="cp">#endif </span><span class="c1">// not defined __AVR_ATtinyX313__</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">loop</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{}</span> <span class="c1">// this program runs only once, thus it resides in setup()</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="basic_api.html" class="btn btn-neutral float-right" title="Basic API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="py_examples.html" class="btn btn-neutral float-left" title="Python Wrapper examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, 2bndy5

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>